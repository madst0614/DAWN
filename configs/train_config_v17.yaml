# DAWN v17 Training Config
# Soft Selection Training (v16-based + soft/hard selection)
# 학습: 전체 뉴런 soft selection (gradient flow to all)
# 추론: top-k hard selection (efficiency)

# Data
data:
  base_dir: /content/drive/MyDrive/data
  train_files:
    - train/wikitext_5to1_texts.pkl
  val_files:
    - val/wikitext_5to1_texts.pkl

# Model Architecture
model:
  model_version: "17.0"
  d_model: 320
  n_layers: 4
  n_heads: 4
  rank: 64                          # rank matrix dimension
  state_dim: 64

  # Split Feature pools (rank matrix)
  n_feature_qk: 28                  # Q/K path compression [n, D, R]
  n_feature_v: 16                   # V path compression [n, D, R]
  top_k_feature_qk: 6               # inference only
  top_k_feature_v: 4                # inference only

  # Expansion neurons (rank matrix)
  n_relational: 160                 # Q/K expansion [n, R, D]
  n_value: 12                       # V expansion [n, R, D]
  top_k_relational: 16              # inference only
  top_k_value: 3                    # inference only

  # Knowledge neurons
  n_knowledge: 80
  coarse_k: 20
  fine_k: 10
  knowledge_rank: 128

  max_seq_len: 128
  dropout: 0.1

  # Router settings
  d_space: 64
  router_dropout: 0.1
  temperature: 1.0                  # soft selection sharpness
  use_ssm_context: true
  gradient_checkpointing: false

# Training
training:
  batch_size: 128
  num_epochs: 30
  lr: 0.0003
  weight_decay: 0.1
  warmup_epochs: 2

  # Regularization
  orthogonality_weight: 0.01        # rank matrix orthogonality
  diversity_weight: 0.1
  load_balance_weight: 0.03         # aux_loss coefficient
  entropy_weight: 0.0
  process_norm_weight: 0.0

use_amp: true
checkpoint_dir: /content/drive/MyDrive/dawn/checkpoints_v17
log_dir: /content/drive/MyDrive/dawn/logs_v17

# v17 Changes from v16:
#   - Training: soft selection (all neurons participate, gradient flow)
#   - Inference: top-k hard selection (efficiency)
#   - Temperature parameter for controlling selection sharpness
#   - Same rank matrix architecture as v16
#   - top_k values only used during inference
