# DAWN v16 Training Config
# Vector Neurons: 각 뉴런 = 하나의 축 벡터
# Feature_QK / Feature_V 분리

# Data
data:
  base_dir: /content/drive/MyDrive/data
  train_files:
    - train/wikitext_5to1_texts.pkl
  val_files:
    - val/wikitext_5to1_texts.pkl

# Model Architecture
model:
  model_version: "16.0"
  d_model: 320
  n_layers: 4
  n_heads: 4
  rank_qk: 64                    # Q/K용 축 수 (= top_k_feature_qk)
  rank_v: 32                     # V용 축 수 (= top_k_feature_v)
  state_dim: 64

  # Feature 벡터 뉴런 (v16 핵심)
  n_feature_qk: 128              # Q/K용 축 벡터 수
  n_feature_v: 64                # V용 축 벡터 수
  top_k_feature_qk: 64           # 64개 축 선택
  top_k_feature_v: 32            # 32개 축 선택

  # RVK 뉴런 (유지)
  n_relational: 48
  n_value: 12
  n_knowledge: 80
  coarse_k: 20
  fine_k: 10
  knowledge_rank: 128

  max_seq_len: 128
  dropout: 0.1

  # Top-k sparse mixing
  top_k_relational: 12
  top_k_value: 3

  # Router settings
  d_space: 64
  router_dropout: 0.1
  token_routing: false
  use_ssm_context: true
  gradient_checkpointing: false

# Training
training:
  batch_size: 128
  num_epochs: 30
  lr: 0.0003
  weight_decay: 0.1
  warmup_epochs: 2

  # Regularization
  orthogonality_weight: 0.01
  diversity_weight: 0.1
  load_balance_weight: 0.0
  entropy_weight: 0.0
  process_norm_weight: 0.0

use_amp: true
checkpoint_dir: /content/drive/MyDrive/dawn/checkpoints_v16
log_dir: /content/drive/MyDrive/dawn/logs_v16

# v16 Changes from v15:
#   - Feature neurons → Vector neurons (각 뉴런 = 하나의 축)
#   - Feature_QK / Feature_V 분리
#   - n_feature_qk: 128개 벡터 중 64개 선택 → 64차원
#   - n_feature_v: 64개 벡터 중 32개 선택 → 32차원
#   - Top-k 후 idx 정렬 → 위치 고정 학습
#
# 파라미터 비교:
#   v15:
#     feature: 12 × 320 × 64 = 246K
#
#   v16:
#     feature_qk: 128 × 320 = 41K
#     feature_v: 64 × 320 = 20K
#     expand_Q: 64 × 320 = 20K
#     expand_K: 64 × 320 = 20K
#     expand_V: 32 × 320 = 10K
#     총: 111K
#
#   절감: 55%
