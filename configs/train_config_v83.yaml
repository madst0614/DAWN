# DAWN v8.3 Training Config
# v8.2 기반, NeuronMemory Query를 Compressor로 변경
#
# 변경사항:
#   - NeuronMemory의 W_Q → query_compressor (neuron_type='m')
#   - process_neurons_m 추가 (Memory Query용 Householder 벡터)
#
# 기대 효과:
#   - Memory Query도 동일한 Neuron 방식으로 처리
#   - 더 일관된 아키텍처

# Data
data:
  base_dir: /content/drive/MyDrive/data
  train_file: train/wikitext_5to1_texts.pkl
  val_file: validation/wikitext_5to1_texts.pkl

# Model Architecture (v8.3: v8.2 + Memory Query Compressor)
model:
  model_version: "8.3"    # DAWN v8.3 - Memory Query Compressor
  d_model: 256            # Hidden dimension
  n_layers: 4             # Number of transformer layers
  n_heads: 4              # Number of attention heads

  # TransformNeurons parameters (shared across layers)
  rank: 64                # Projection rank (4 heads x 16 d_head)
  n_input: 8              # Number of input neurons (256 -> 64 compression)
  n_process: 32           # Number of Householder process neurons (QK/V/O/M 각각)
  n_output: 8             # Number of output neurons (64 -> 256 restoration)
  process_k: 3            # Number of process neurons to select (top-k)

  # KnowledgeNeurons parameters (v8.0과 동일)
  n_knowledge: 64         # Number of knowledge neurons
  knowledge_k: 8          # Number of knowledge neurons to retrieve (top-k)

  # Architecture
  max_seq_len: 128        # Maximum sequence length
  dropout: 0.1            # Dropout rate

# Training
training:
  batch_size: 128         # Batch size
  num_epochs: 30          # Total epochs
  lr: 0.0003              # Learning rate
  weight_decay: 0.1       # Weight decay for regularization
  warmup_epochs: 2        # Warmup epochs

  # Regularization (same as v8.0)
  orthogonality_weight: 0.01   # Input/Output neuron orthogonality loss
  process_norm_weight: 0.01    # Process neuron norm regularization (||v|| = 1)
  load_balance_weight: 0.01    # Load balance loss for routing

# Mixed precision (faster training on GPU)
use_amp: true

# Paths
checkpoint_dir: /content/drive/MyDrive/dawn/checkpoints_v83
log_dir: /content/drive/MyDrive/dawn/checkpoints_v83

# Notes:
# v8.3 Changes from v8.2:
# - NeuronMemory의 W_Q Linear 삭제
# - query_compressor (neuron_type='m') 추가
# - process_neurons_m 추가 (Memory Query용)
#
# Parameter count change:
#   ProcessNeuron: 32 x 64 x 3 = 6K → 32 x 64 x 4 = 8K (+2K)
#   W_Q 삭제: 256 x 64 x 4 layers = 65K 삭제
#   query_compressor 추가: input_router + process_router per layer
#   총: 파라미터 감소 예상 (W_Q 삭제 > process_neurons_m 추가)
