# DAWN v10.1 Training Config - 18M Scale (A100 80GB)
# Top-K Sparse Compress/Expand Architecture
# v10.0과 동일 파라미터, top-k로 속도/메모리 개선

# Data
data:
  base_dir: /content/drive/MyDrive/data
  train_files:
    - train/c4/c4_raw_000.pt
  val_files:
    - val/c4/c4_val_50M.pt
  max_train_tokens: 360000000  # 360M tokens
  max_val_tokens: 10000000     # 10M tokens

# Model Architecture
model:
  model_version: "10.1"
  d_model: 320
  n_layers: 8
  n_heads: 4
  rank: 64
  n_compress: 224
  n_expand: 56
  n_knowledge: 256
  knowledge_k: 12
  max_seq_len: 128
  dropout: 0.1

  # Top-K Selection (v10.1 핵심)
  compress_top_k: 8       # 224개 중 8개만 선택 (3.6%)
  expand_top_k: 4         # 56개 중 4개만 선택 (7.1%)
  router_noise: 0.1       # 학습 시 탐색용 noise

# Training
training:
  batch_size: 256
  num_epochs: 5
  lr: 0.0004
  weight_decay: 0.1
  warmup_ratio: 0.05

  # Regularization
  orthogonality_weight: 0.01
  diversity_weight: 0.1
  load_balance_weight: 0.01
  process_norm_weight: 0.0

use_amp: true
checkpoint_dir: /content/drive/MyDrive/dawn/checkpoints_v10_1
log_dir: /content/drive/MyDrive/dawn/logs_v10_1

# =============================================================================
# v10.0 vs v10.1 비교 (동일 파라미터, 18M)
# =============================================================================
#
# | 항목              | v10.0 (soft)      | v10.1 (top-k)        |
# |-------------------|-------------------|----------------------|
# | n_compress        | 224               | 224                  |
# | n_expand          | 56                | 56                   |
# | Compressor 연산   | 224개 전부         | 8개만 (top-k)        |
# | Expander 연산     | 56개 전부          | 4개만 (top-k)        |
# | 메모리            | ~50GB             | ~15GB 예상           |
# | 속도              | 기준               | ~3x 빠름 예상        |
#
# =============================================================================
# 파라미터 계산 (v10.0과 동일):
# =============================================================================
#   compress: 224 × 320 × 64 = 4,587,520 (4.59M)
#   expand: 56 × 64 × 320 = 1,146,880 (1.15M)
#   knowledge: 256×64 + 256×320 = 98,304 (98K)
#   SharedNeurons 총: ~5.83M
#
#   embeddings: 30522 × 320 = 9.77M
#   pos_emb: 128 × 320 = 41K
#   routers: ~2.2M (8 layers)
#   layernorms: ~20K
#
#   Total: ~18M
# =============================================================================
