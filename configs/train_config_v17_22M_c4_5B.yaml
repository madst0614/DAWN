# DAWN v17 Training Config - 22M Scale, 5B tokens
# Hierarchical Neuron Circuits with Neuron Embeddings
# Based on v16.2 optimized architecture

# Data
data:
  base_dir: /content/drive/MyDrive/data
  train_files:
    - train/c4/c4_raw_000.pt
    - train/c4/c4_raw_001.pt
    - train/c4/c4_raw_002.pt
    - train/c4/c4_raw_003.pt
    - train/c4/c4_raw_004.pt
    - train/c4/c4_raw_005.pt
    - train/c4/c4_raw_006.pt
    - train/c4/c4_raw_007.pt
    - train/c4/c4_raw_008.pt
    - train/c4/c4_raw_009.pt
  val_files:
    - val/c4/c4_val_50M.pt
  max_train_tokens: 5000000000
  max_val_tokens: 2000000

# Model Architecture
model:
  model_version: "17.0"
  d_model: 384
  n_layers: 12
  n_heads: 6
  max_seq_len: 512
  dropout: 0.1

  # Circuit Architecture
  # Circuit = team of cooperating neurons [neurons_per_circuit, d_model]
  # 2-level routing: Circuit selection (top-k) + Neuron weighting (softmax)
  neurons_per_circuit: 64

  # Feature Circuits (compression: d_model → neurons)
  n_circuits_r: 96              # Q/K compression (was n_feature_r)
  n_circuits_v: 24              # V compression (was n_feature_v)
  top_k_circuits_r: 12
  top_k_circuits_v: 3

  # Expansion Circuits (expansion: neurons → d_model)
  n_circuits_rel: 96            # Q/K expansion (was n_relational)
  n_circuits_val: 16            # V expansion (was n_value)
  top_k_circuits_rel: 12
  top_k_circuits_val: 2

  # Knowledge Neurons (unchanged from v16.2)
  n_knowledge: 300
  coarse_k: 16
  fine_k: 8
  knowledge_rank: 128

  # SSM & Router
  state_dim: 64
  d_space: 64
  router_dropout: 0.1
  use_ssm_context: true

  # Excitability & Langevin dynamics
  excitability_tau: 1.5
  excitability_ema_alpha: 0.01
  langevin_alpha: 0.0003
  langevin_beta: 0.0006

  gradient_checkpointing: false

# Training
training:
  batch_size: 96
  num_epochs: 1
  lr: 0.00055
  weight_decay: 0.1
  warmup_ratio: 0.06

  # Auxiliary losses
  circuit_diversity_weight: 0.1       # circuit 간 다양성
  neuron_orthogonality_weight: 0.01   # circuit 내 neuron 직교성

use_amp: true
checkpoint_dir: /content/drive/MyDrive/dawn/checkpoints_v17_22M_c4_5B
log_dir: /content/drive/MyDrive/dawn/logs_v17_22M_c4_5B

# =============================================================================
# v17 Architecture Summary
# =============================================================================
#
# Key Changes from v16.2:
#   - 2-level hierarchical routing (circuit → neuron)
#   - Neuron embeddings for circuit-aware inner weight computation
#   - Circuit = team of neurons that cooperate
#
# Parameter Mapping (v16.2 → v17):
#   n_feature_r: 96    → n_circuits_r: 96
#   n_feature_v: 24    → n_circuits_v: 24
#   n_relational: 96   → n_circuits_rel: 96
#   n_value: 16        → n_circuits_val: 16
#   rank: 64           → neurons_per_circuit: 64
#
# Circuit Parameters:
#   Feature_R:   96 × 64 × 384 = 2.36M
#   Feature_V:   24 × 64 × 384 = 0.59M
#   Relational:  96 × 64 × 384 = 2.36M
#   Value:       16 × 64 × 384 = 0.39M
#   Neuron Emb:  (96+24+96+16) × 64 × 64 = 0.95M
#   Neuron Proj: 384 × 64 × 3 = 0.07M
#
# Additional params vs v16.2: ~1M (4.5% of 22M)
# =============================================================================
